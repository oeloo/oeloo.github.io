<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glycemia Chart Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        .container {
            display: flex;
            width: 100%;
            justify-content: space-between;
            gap: 20px;
        }
        #input-container {
            width: 30%;
        }
        textarea {
            width: 100%;
            height: 300px;
            font-size: 14px;
        }
        .threshold-inputs {
            margin-top: 10px;
        }
        .threshold-inputs label {
            display: block;
            margin-top: 5px;
        }
        #chart-container {
            width: 65%;
            height: 500px;
            border: 1px solid #ddd;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .language-picker {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .language-picker select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .flag {
            width: 20px;
            height: 15px;
            display: inline-block;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-picker">
        <select id="language-selector" onchange="changeLanguage(this.value)">
            <option value="en" data-flag="üá¨üáß">English</option>
            <option value="fr" data-flag="üá´üá∑">Fran√ßais</option>
            <option value="es" data-flag="üá™üá∏">Espa√±ol</option>
            <option value="de" data-flag="üá©üá™">Deutsch</option>
            <option value="zh" data-flag="üá®üá≥">‰∏≠Êñá</option>
            <option value="ja" data-flag="üáØüáµ">Êó•Êú¨Ë™û</option>
            <option value="ru" data-flag="üá∑üá∫">–†—É—Å—Å–∫–∏–π</option>
            <option value="pt" data-flag="üáµüáπ">Portugu√™s</option>
        </select>
    </div>

    <h2 id="main-title">Glycemia Chart Generator</h2>
    
    <div class="container">
        <!-- Input Section -->
        <div id="input-container">
            <h3 id="data-title">Enter Glycemia Data</h3>
            <textarea id="data-input" placeholder="Paste your data here...
Format: 8h : 2,95 g/L"></textarea><br>
            
            <div class="threshold-inputs">
                <label for="threshold-min" id="min-threshold-label">Minimum Threshold (g/L):</label>
                <input type="number" id="threshold-min" value="1.0" step="0.1">
                
                <label for="threshold-max" id="max-threshold-label">Maximum Threshold (g/L):</label>
                <input type="number" id="threshold-max" value="2.0" step="0.1">
            </div>
            
            <button onclick="generateChart()" id="generate-button">Generate Chart</button>
        </div>

        <!-- Chart Section -->
        <div id="chart-container">
            <canvas id="glycemiaChart"></canvas>
        </div>
    </div>

    <script>
        // Translations object
        const translations = {
            'en': {
                'mainTitle': 'Glycemia Chart Generator',
                'dataTitle': 'Enter Glycemia Data',
                'minThresholdLabel': 'Minimum Threshold (g/L):',
                'maxThresholdLabel': 'Maximum Threshold (g/L):',
                'generateButton': 'Generate Chart',
                'placeholder': 'Paste your data here...\nFormat: 8h : 2,95 g/L',
                'chartTitle': 'Glycemia Chart',
                'glycemiaLabel': 'Glycemia (g/L)',
                'minThresholdLabel': 'Minimum Threshold',
                'maxThresholdLabel': 'Maximum Threshold',
                'hourLabel': 'Hour'
            },
            'fr': {
                'mainTitle': 'G√©n√©rateur de Courbe de Glyc√©mie',
                'dataTitle': 'Entrez les donn√©es de glyc√©mie',
                'minThresholdLabel': 'Seuil Minimum (g/L):',
                'maxThresholdLabel': 'Seuil Maximum (g/L):',
                'generateButton': 'G√©n√©rer la Courbe',
                'placeholder': 'Collez vos donn√©es ici...\nFormat: 8h : 2,95 g/L',
                'chartTitle': 'Courbe de Glyc√©mie',
                'glycemiaLabel': 'Glyc√©mie (g/L)',
                'minThresholdLabel': 'Seuil Minimum',
                'maxThresholdLabel': 'Seuil Maximum',
                'hourLabel': 'Heure'
            },
            'es': {
                'mainTitle': 'Generador de Gr√°ficos de Glucemia',
                'dataTitle': 'Introduzca los datos de glucemia',
                'minThresholdLabel': 'Umbral M√≠nimo (g/L):',
                'maxThresholdLabel': 'Umbral M√°ximo (g/L):',
                'generateButton': 'Generar Gr√°fico',
                'placeholder': 'Pegue sus datos aqu√≠...\nFormato: 8h : 2,95 g/L',
                'chartTitle': 'Gr√°fico de Glucemia',
                'glycemiaLabel': 'Glucemia (g/L)',
                'minThresholdLabel': 'Umbral M√≠nimo',
                'maxThresholdLabel': 'Umbral M√°ximo',
                'hourLabel': 'Hora'
            },
            'de': {
                'mainTitle': 'Blutzucker-Diagramm-Generator',
                'dataTitle': 'Geben Sie Blutzuckerdaten ein',
                'minThresholdLabel': 'Minimaler Schwellenwert (g/L):',
                'maxThresholdLabel': 'Maximaler Schwellenwert (g/L):',
                'generateButton': 'Diagramm generieren',
                'placeholder': 'F√ºgen Sie Ihre Daten hier ein...\nFormat: 8h : 2,95 g/L',
                'chartTitle': 'Blutzucker-Diagramm',
                'glycemiaLabel': 'Blutzucker (g/L)',
                'minThresholdLabel': 'Minimaler Schwellenwert',
                'maxThresholdLabel': 'Maximaler Schwellenwert',
                'hourLabel': 'Stunde'
            }
            // Add more languages as needed
        };

        // Function to detect browser language
        function detectBrowserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            const langCode = browserLang.split('-')[0]; // Get just the language code part
            
            // Check if we support this language
            if (translations[langCode]) {
                return langCode;
            }
            
            // Default to English if language not supported
            return 'en';
        }

        // Function to change the interface language
        function changeLanguage(langCode) {
            // Default to English if the language is not supported
            const lang = translations[langCode] ? langCode : 'en';
            
            // Update the language selector
            document.getElementById('language-selector').value = lang;
            
            // Update text elements
            document.getElementById('main-title').textContent = translations[lang].mainTitle;
            document.getElementById('data-title').textContent = translations[lang].dataTitle;
            document.getElementById('min-threshold-label').textContent = translations[lang].minThresholdLabel;
            document.getElementById('max-threshold-label').textContent = translations[lang].maxThresholdLabel;
            document.getElementById('generate-button').textContent = translations[lang].generateButton;
            document.getElementById('data-input').placeholder = translations[lang].placeholder;
            
            // Store the selected language
            localStorage.setItem('preferredLanguage', lang);
            
            // If chart exists, update its labels
            if (window.glycemiaChart instanceof Chart) {
                updateChartLabels(lang);
            }
        }

        // Function to update chart labels when language changes
        function updateChartLabels(lang) {
            window.glycemiaChart.options.plugins.title.text = translations[lang].chartTitle;
            window.glycemiaChart.data.datasets[0].label = translations[lang].glycemiaLabel;
            window.glycemiaChart.data.datasets[1].label = translations[lang].minThresholdLabel;
            window.glycemiaChart.data.datasets[2].label = translations[lang].maxThresholdLabel;
            window.glycemiaChart.options.scales.y.title.text = translations[lang].glycemiaLabel;
            window.glycemiaChart.options.scales.x.title.text = translations[lang].hourLabel;
            window.glycemiaChart.update();
        }

        // Function to parse input data
        function parseData(input) {
            const lines = input.trim().split("\n"); // Split each line and remove spaces
            const hours = [];
            const values = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                // Regex to extract hour and value
                const match = line.match(/(\d+h)\s*:\s*([\d,]+)/);
                
                if (match) {
                    hours.push(match[1]); // Extract hour
                    // Convert value to float (replace comma with dot)
                    const value = parseFloat(match[2].replace(",", "."));
                    values.push(value);
                    console.log(`Line ${i+1}: ${match[1]} = ${value}`);
                } else {
                    console.log(`Line ${i+1} not recognized: ${line}`);
                }
            }

            console.log("Hours:", hours);
            console.log("Values:", values);
            return { hours, values };
        }

        // Function to generate the chart
        function generateChart() {
            const input = document.getElementById("data-input").value; // Get input data
            
            if (!input.trim()) {
                alert("Please enter data");
                return;
            }
            
            const { hours, values } = parseData(input);

            // Check if valid data was extracted
            if (hours.length === 0 || values.length === 0) {
                alert("No valid data found. Please enter data in the format: '8h : 2,95 g/L'");
                return;
            }

            // Get threshold values from inputs
            const thresholdMinValue = parseFloat(document.getElementById("threshold-min").value);
            const thresholdMaxValue = parseFloat(document.getElementById("threshold-max").value);
            
            // Create arrays with threshold values
            const thresholdMin = Array(hours.length).fill(thresholdMinValue);
            const thresholdMax = Array(hours.length).fill(thresholdMaxValue);

            // Get current language
            const currentLang = localStorage.getItem('preferredLanguage') || 'en';

            // Destroy previous chart if it exists
            if (window.glycemiaChart instanceof Chart) {
                window.glycemiaChart.destroy();
            }

            // Create the chart
            const ctx = document.getElementById("glycemiaChart").getContext("2d");
            window.glycemiaChart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: translations[currentLang].glycemiaLabel,
                            data: values,
                            borderColor: "blue",
                            backgroundColor: "rgba(0, 0, 255, 0.1)",
                            fill: false,
                            tension: 0.4,
                            pointStyle: "circle",
                            pointRadius: 5,
                        },
                        {
                            label: translations[currentLang].minThresholdLabel,
                            data: thresholdMin,
                            borderColor: "orange",
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0,
                        },
                        {
                            label: translations[currentLang].maxThresholdLabel,
                            data: thresholdMax,
                            borderColor: "red",
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: "top" },
                        title: {
                            display: true,
                            text: translations[currentLang].chartTitle
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: false,
                            min: 0,
                            max: Math.max(...values) + 0.5,
                            title: {
                                display: true,
                                text: translations[currentLang].glycemiaLabel
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: translations[currentLang].hourLabel
                            }
                        }
                    },
                },
            });
            
            console.log("Chart successfully generated");
        }
        
        // Initialize the page on load
        window.onload = function() {
            // Pre-fill with example data for testing
            document.getElementById("data-input").value = 
`8h : 2,95 g/L
9h : 2,91 g/L
10h : 1,67 g/L
11h : 1,4 g/L
12h : 1,17 g/L
13h : 0,78 g/L
14h : 0,8 g/L
15h : 2,33 g/L
16h : 2,05 g/L
17h : 2,21 g/L
18h : 2,37 g/L
19h : 2,74 g/L
20h : 2,87 g/L`;

            // Check for saved language preference
            let preferredLang = localStorage.getItem('preferredLanguage');
            
            // If no saved preference, detect browser language
            if (!preferredLang) {
                preferredLang = detectBrowserLanguage();
            }
            
            // Set the interface language
            changeLanguage(preferredLang);
        };
    </script>
</body>
</html>
